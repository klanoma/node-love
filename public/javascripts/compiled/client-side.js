// Generated by CoffeeScript 1.4.0
(function() {
  var animation_delay, animation_speed, changePage, cleanURL, loadPageContent;

  animation_speed = 700;

  animation_delay = 300;

  $(function() {
    loadPageContent(cleanURL(window.location.pathname), false);
    $(".container").hide().delay(animation_delay).fadeIn(animation_speed);
    return $(document).on("click", ".primary-navigation li a, .logo a", function(e) {
      e.preventDefault();
      return changePage(cleanURL($(this).attr("href")));
    });
  });

  changePage = function(newURL) {
    if ($("body").attr("class") === newURL) {
      return;
    }
    loadPageContent(newURL, true);
    if (typeof _gaq !== "undefined") {
      return _gaq.push(["_trackPageview", newURL + "/"]);
    }
  };

  loadPageContent = function(newURL, pageChange) {
    var pageSlug;
    pageSlug = (newURL === "" ? "index" : newURL);
    return $.get("/pages/" + pageSlug, function(data) {
      if (pageChange) {
        History.pushState(pageSlug, document.title.replace(/^(.*)\|.*$/, "$1 | ") + data.title, "/" + newURL);
      }
      $("body").attr("class", pageSlug);
      return $("#content-wrapper").showHtml(ich.content(data, animation_speed));
    });
  };

  cleanURL = function(uncleanURL) {
    return uncleanURL.replace(/^\/|\/$/g, "");
  };

}).call(this);
